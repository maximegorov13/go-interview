# Balancer, Rate Limit, Circuit Breaker, Мониторинг

## Balancer (Балансировщик нагрузки)

### Что такое балансировка нагрузки?

Балансировка нагрузки — это процесс распределения входящих запросов между несколькими серверами для повышения доступности, производительности и отказоустойчивости системы.

### Типы балансировщиков

1. **Аппаратные (Hardware Balancer):**
   - Используют специализированное оборудование.
   - Высокая производительность, но дорого и сложнее в настройке.
2. **Программные (Software Balancer):**
   - Реализуются через ПО, такие как Nginx, HAProxy, Envoy, Traefik.
   - Более гибкие, дешевле и легче в управлении.

### Алгоритмы балансировки

1. **Round Robin:**
   - Запросы распределяются равномерно по кругу между серверами.
   - Простой и эффективный для одинаково нагруженных серверов.
2. **Least Connections:**
   - Запрос направляется на сервер с наименьшим числом активных соединений.
   - Хорош для систем с разной нагрузкой на запрос.
3. **IP Hash:**
   - Запросы от одного IP направляются на один и тот же сервер.
   - Полезно для случаев, где важно сохранять сессии.
4. **Weighted Round Robin:**
   - Учитывает вес каждого сервера для распределения нагрузки.
   - Серверы с более высокой мощностью получают больше запросов.

### Преимущества

- Повышение отказоустойчивости.
- Оптимизация использования ресурсов.
- Уменьшение времени отклика.

## Rate Limit (Ограничение скорости)

### Что такое Rate Limit?

Rate Limit — это ограничение на количество запросов, которые клиент может отправить за определённый промежуток времени. Используется для защиты ресурсов от перегрузки и злоупотреблений.

### Механизмы Rate Limiting

1. **Fixed Window:**
   - Ограничение запросов в фиксированный интервал времени (например, 100 запросов в минуту).
   - Простая реализация, но возможны всплески запросов на границах окна.
2. **Sliding Window:**
   - Счётчик обновляется при каждом запросе, учитывая последние N секунд.
   - Более точное распределение запросов.
3. **Token Bucket:**
   - У клиента есть определённое количество "токенов", которые он может потратить на запросы.
   - Токены добавляются с определённой скоростью.
   - Подходит для нерегулярных запросов.
4. **Leaky Bucket:**
   - Похож на Token Bucket, но запросы обрабатываются с фиксированной скоростью.
   - Избыточные запросы отбрасываются.

### Где используется

- API (ограничение запросов от клиентов).
- Сервисы с высокой нагрузкой.
- Защита от DoS/DDoS-атак.

## Circuit Breaker (Схема размыкания цепи)

### Что такое Circuit Breaker?

Circuit Breaker — это паттерн проектирования, который используется для предотвращения перегрузки сервисов и обеспечения устойчивости системы при сбоях.

### Принципы работы

1. **Closed State (Закрытое состояние):**
   - Все запросы проходят к зависимому сервису.
   - При успешной обработке запросов схема остаётся закрытой.
2. **Open State (Открытое состояние):**
   - После определённого числа ошибок схема "размыкается", и запросы сразу отклоняются.
   - Это снижает нагрузку на зависимый сервис.
3. **Half-Open State (Полуоткрытое состояние):**
   - После определённого интервала времени схема начинает пропускать ограниченное количество запросов.
   - Если запросы успешны, схема возвращается в закрытое состояние.

### Преимущества

- Снижение нагрузки на зависимые сервисы в случае их сбоя.
- Улучшение отказоустойчивости системы.
- Предотвращение "каскадных" сбоев.

## Мониторинг

### Что такое мониторинг?

Мониторинг — это процесс наблюдения за состоянием системы для выявления проблем, анализа производительности и обеспечения её стабильности.

### Основные компоненты мониторинга

1. **Сбор данных:**
   - Метрики (нагрузка на CPU, использование памяти, время отклика).
   - Логи (события, ошибки, предупреждения).
   - Трейсы (данные о выполнении запросов и взаимодействии сервисов).
2. **Анализ данных:**
   - Автоматический анализ собранных данных для выявления проблем.
   - Вычисление ключевых метрик (например, среднее время отклика).
3. **Алёртинг:**
   - Настройка уведомлений для предупреждения о проблемах.
4. **Визуализация:**
   - Дашборды и графики для представления данных в удобной форме.

### Инструменты мониторинга

- **Prometheus:** Сбор, хранение и анализ метрик.
- **Grafana:** Визуализация данных из разных источников.
- **ELK Stack (Elasticsearch, Logstash, Kibana):** Анализ и визуализация логов.
- **Jaeger:** Трассировка запросов.
- **DataDog:** Мониторинг облачных приложений.

### Виды мониторинга

1. **Инфраструктурный мониторинг:**
   - Мониторинг серверов, контейнеров, сетей.
   - Примеры метрик: загрузка CPU, использование диска.
2. **Приложенческий мониторинг:**
   - Мониторинг работы приложений.
   - Примеры метрик: время отклика, количество запросов.
3. **Сетевой мониторинг:**
   - Анализ сетевого трафика.
   - Примеры: задержки, потеря пакетов.
4. **Бизнес-мониторинг:**
   - Отслеживание ключевых показателей (например, число заказов, выручка).

### Преимущества мониторинга

- Раннее обнаружение проблем.
- Повышение доступности и стабильности системы.
- Анализ производительности и возможностей для оптимизации.

## Резюме

| **Тема**            | **Описание**                                                                                         |
| ------------------- | ---------------------------------------------------------------------------------------------------- |
| **Balancer**        | Распределяет запросы между серверами для повышения доступности и производительности.                 |
| **Rate Limit**      | Ограничивает количество запросов, чтобы избежать перегрузки и злоупотреблений.                       |
| **Circuit Breaker** | Предотвращает каскадные сбои, размыкая цепь при сбоях зависимых сервисов.                            |
| **Мониторинг**      | Отслеживает состояние системы, собирает данные и предоставляет аналитику для повышения стабильности. |

Эти концепции являются важными для построения надёжных, масштабируемых и производительных систем.
