# Kubernetes (K8s)

## Что такое Kubernetes?

**Kubernetes (K8s)** — это платформа оркестрации контейнеров с открытым исходным кодом. Она автоматизирует развертывание, управление, масштабирование и мониторинг контейнеризированных приложений.

## Основные возможности Kubernetes

1. **Оркестрация контейнеров:**
   - Управление группами контейнеров (запуск, обновление, удаление).

2. **Масштабирование:**
   - Автоматическое добавление или удаление контейнеров в зависимости от нагрузки.

3. **Мониторинг:**
   - Проверка состояния приложений и инфраструктуры.

4. **Управление состоянием приложений:**
   - Kubernetes следит, чтобы запущенные приложения соответствовали заданным конфигурациям.

5. **Автоматическое восстановление:**
   - Перезапуск контейнеров при сбоях, перераспределение нагрузки.

## Основные компоненты Kubernetes

### Под (Pod)

- **Определение:**
  Минимальная единица развертывания в Kubernetes. Под — это обертка вокруг одного или нескольких контейнеров.

- **Особенности:**
  - Контейнеры в одном поде используют общий IP-адрес и файловую систему.
  - Обычно содержит один контейнер, но может включать несколько для тесно связанных приложений.

**Применение:**

- Развертывание приложения или его компонентов.

### Сервис (Service)

- **Определение:** Логический компонент, который объединяет поды в группы и обеспечивает стабильный IP-адрес.

- **Особенности:**
  - Балансирует нагрузку между подами.
  - Обеспечивает сетевое взаимодействие между подами и внешними пользователями.

**Примеры использования:**

- Обеспечение доступа к приложению через постоянный IP-адрес.
- Балансировка нагрузки для группы подов.

### Контроллеры

- **Replication Controller:**
  - Гарантирует, что заданное количество подов работает в любой момент времени.

- **Deployment:**
  - Управляет обновлением и откатом приложений. Это наиболее часто используемый контроллер.

- **StatefulSet:**
  - Управляет состоянием подов, которые требуют сохранения состояния (например, базы данных).

- **DaemonSet:**
  - Запускает один экземпляр пода на каждом узле кластера.

- **Job/CronJob:**
  - Job — для выполнения задач один раз. CronJob — для периодических задач.

### API-сервер

- Основной компонент, который обрабатывает все запросы к кластеру.
- Принимает файлы конфигурации (YAML) и передает их остальным компонентам.

### Контроллер-менеджер (Controller Manager)

- Отслеживает состояние кластера и поддерживает его в соответствии с заданными конфигурациями.
- Перезапускает поды, если они упали.

### Этсиди (etcd)

- **Система хранения конфигурации:**
  - Хранит все данные о состоянии кластера в формате key-value.

### Планировщик (Scheduler)

- Назначает поды на узлы кластера на основе ресурсов и ограничений.

## Как работает Kubernetes?

1. **Декларативный стиль управления:**
   - Пользователь описывает желаемое состояние системы (например, колич��ство подов) в файле YAML.
   - Kubernetes самостоятельно приводит систему в это состояние.

2. **Централизованное управление через API-сервер:**
   - Все компоненты взаимодействуют через API-серв��р.

3. **Мониторинг и восстановление:**
   - Контроллер-менеджер следит за состоянием подов и восстанавливает их в случае сбоя.

## Основные понятия Kubernetes

| Компонент             | Описание                                                                      |
| --------------------- | ----------------------------------------------------------------------------- |
| **Под (Pod)**         | Минимальная единица развертывания, содержащая контейнеры.                     |
| **Сервис (Service)**  | Обеспечивает стабильный доступ к группе подов.                                |
| **Кластер (Cluster)** | Группа узлов, управляемая Kubernetes.                                         |
| **Узел (Node)**       | Физический или виртуальный сервер, на котором запускаются поды.               |
| **Deployment**        | Контроллер для управления развертыванием приложений.                          |
| **Ingress**           | Обеспечивает внешний доступ к приложениям (например, через HTTP/HTTPS).       |
| **ConfigMap**         | Хранит конфигурационные данные для приложений.                                |
| **Secret**            | Хранит чувствительные данные, такие как пароли и ключи.                       |
| **Volume**            | Хранит данные для контейнеров, которые сохраняются даже при перезапуске пода. |

## Архитектура Kubernetes

1. **Мастер (Control Plane):**
   - Состоит из API-сервера, контроллер-менеджера, планировщика и etcd.
   - Управляет состоянием кластера.

2. **Узел (Node):**
   - Рабочий сервер, который выполняет поды.
   - Содержит компоненты:
     - **kubelet** — агент для связи с API-сервером.
     - **kube-proxy** — отвечает за сетевой трафик внутри кластера.

## Принципы работы Kubernetes

1.  **Автоматизация:**
    - Kubernetes автоматически масштабирует, перезапускает и заменяет поды при необходимости.

2.  **Слабая связанность:**
    - Компоненты работают независимо друг от друга.

3.  **Масштабируемость:**
    - Возможность легко добавлять или удалять узлы и поды.

4.  **Самовосстановление:**
    - Упавшие поды автоматически перезапускаются.

## Пример использования Kubernetes

1. **Масштабирование:**
   - Если нагрузка на приложение увеличивается, Kubernetes автоматически создаёт больше подов.

2. **Обновления без простоя:**
   - С помощью **Deployment** можно развернуть новую версию приложения, не прерывая работу пользователей.

3. **Сетевое взаимодействие:**
   - Использование **Service** для балансировки нагрузки между подами.

## Преимущества Kubernetes

1. **Автоматизация управления контейнерами.**

2. **Масштабирование в зависимости от нагрузки.**

3. **Самовосстановление приложений.**

4. **Многообразие интеграций с инструментами CI/CD.**

5. **Обеспечение высокой доступности приложений.**

## Резюме

| Компонент            | Роль                                                                  |
| -------------------- | --------------------------------------------------------------------- |
| **Под (Pod)**        | Контейнер или группа контейнеров с общим IP и ресурсами.              |
| **Сервис (Service)** | Постоянный IP и балансировка нагрузки для группы подов.               |
| **Контроллеры**      | Обеспечивают масштабируемость, обновления и восстановление состояния. |
| **API-сервер**       | Централизованное управление кластером.                                |
| **Scheduler**        | Планирует запуск подов на узлах.                                      |
| **etcd**             | Хранилище данных о состоянии кластера.                                |
