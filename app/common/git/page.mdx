# Git

## Основные команды Git

### Инициализация репозитория

- **`git init`** — Инициализирует новый репозиторий Git.

### Работа с файлами

- **`git add <file>`** — Добавляет файл в область подготовки.
- **`git add .`** — Добавляет все файлы из текущей директории в область подготовки.
- **`git rm <file>`** — Удаляет файл из репозитория и индекса.
- **`git checkout -- <file>`** — Отменяет изменения в файле, возвращая его к состоянию последнего коммита.

### Создание коммитов

- **`git commit -m "message"`** — Создает новый коммит с указанным сообщением.
- **`git commit --amend -m "New message"`** — Изменяет последний коммит (например, исправление описания).
- **`git revert <commit>`** — Отменяет изменения, сделанные в указанном коммите.

### Просмотр истории изменений

- **`git status`** — Показывает текущий статус файлов (изменённые, подготовленные к коммиту и неотслеживаемые).
- **`git log`** — Отображает историю коммитов.
- **`git log -p`** — Показывает изменения, внесённые в каждом коммите.
- **`git show <commit>`** — Отображает изменения в указанном коммите.

### Работа с ветками

- **`git branch`** — Показывает список локальных веток.
- **`git branch -a`** — Показывает все ветки, включая удалённые.
- **`git branch <branch_name>`** — Создаёт новую ветку.
- **`git checkout <branch_name>`** — Переключается на указанную ветку.
- **`git switch <branch_name>`** — Переключается на указанную ветку.
- **`git checkout -b <branch_name>`** — Создаёт и переключается на новую ветку.
- **`git switch -c <branch_name>`** — Создаёт и переключается на новую ветку.
- **`git merge <branch_name>`** — Сливает указанную ветку в текущую.
- **`git merge --abort`** — Отменяет слияние в случае конфликта.
- **`git rebase <branch_name>`** — Переносит текущие коммиты на другую ветку.

### Работа с удалёнными репозиториями

- **`git remote add origin <url>`** — Добавляет удалённый репозиторий с именем `origin`.
- **`git push origin <branch>`** — Отправляет изменения в указанную ветку удалённого репозитория.
- **`git push --set-upstream origin <branch>`** — Устанавливает ветку как основную для `push/pull`.
- **`git pull origin <branch>`** — Получает изменения из удалённого репозитория и сливает их с текущей веткой.
- **`git fetch origin`** — Получает изменения из удалённого репозитория, но не сливает их.

### Работа с тегами

- **`git tag <tag_name>`** — Создаёт аннотированный тег для текущего коммита.
- **`git tag -a <tag_name> -m "message"`** — Создаёт тег с сообщением.
- **`git push origin <tag_name>`** — Отправляет тег в удалённый репозиторий.

### Игнорирование файлов

- **`.gitignore`** — Файл, содержащий правила исключения файлов из отслеживания.

### Полезные команды для отладки

- **`git diff`** — Показывает различия между изменениями в рабочей директории.
- **`git diff --staged`** — Показывает изменения, добавленные в область подготовки.
- **`git stash`** — Сохраняет текущие изменения в стек, очищая рабочую директорию.
- **`git stash apply`** — Восстанавливает сохранённые изменения из стека.
- **`git clean -f`** — Удаляет неотслеживаемые файлы из рабочей директории.

### Восстановление изменений

- **`git reset HEAD <file>`** — Убирает файл из области подготовки.
- **`git reset --soft <commit>`** — Возвращает ветку к указанному коммиту, сохраняя изменения в рабочей директории.
- **`git reset --hard <commit>`** — Возвращает ветку к указанному коммиту, удаляя все изменения.

### Работа с подмодулями

- **`git submodule add <repo_url>`** — Добавляет подмодуль в проект.
- **`git submodule update --init --recursive`** — Инициализирует и обновляет подмодули.

## Модель ветвления Gitflow

[Удачная модель ветвления для Git](https://habr.com/ru/articles/106912/)

![Gitflow](/images/git/gitflow.png)

### Этапы (по Gitflow)

- **`master`** — стабильные релизы, каждый коммит соответствует версии.
- **`develop`** — основная ветка разработки, интеграция новых изменений.
- **`feature/*`** — разработка отдельных фич от `develop`, после готовности слияние обратно.
- **`release/*`** — подготовка релиза: только багфиксы, метаданные, версия; затем слияние в `master` и `develop`.
- **`hotfix/*`** — срочные исправления от `master` для продакшена; затем слияние в `master` и `develop`.

![Главные ветви master и develop](/images/git/main_branches.png)

### Feature branch: создание ветки

Ответвление новой фичи от `develop`.

![Ветви функциональностей](/images/git/feature_branches.png)

```shell
$ git checkout -b myfeature develop
Switched to a new branch "myfeature"
```

### Feature branch: слияние в develop

Возврат готовой фичи в основную ветку разработки.

```shell
$ git checkout develop
Switched to branch 'develop'
$ git merge --no-ff myfeature
Updating ea1b82a..05e9557
(Отчёт об изменениях)
$ git branch -d myfeature
Deleted branch myfeature (was 05e9557).
$ git push origin develop
```

![Слияние с --no-ff](/images/git/no_ff_merge.png)

### Release branch: создание ветки

Ответвление релиза от `develop` и фиксация версии.

```shell
$ git checkout -b release-1.2 develop
Switched to a new branch "release-1.2"
$ ./bump-version.sh 1.2
Files modified successfully, version bumped to 1.2.
$ git commit -a -m "Bumped version number to 1.2"
[release-1.2 74d9424] Bumped version number to 1.2
1 files changed, 1 insertions(+), 1 deletions(-)
```

### Release branch: выпуск релиза

Слияние в `master` и тегирование версии.

```shell
$ git checkout master
Switched to branch 'master'
$ git merge --no-ff release-1.2
Merge made by recursive.
(Отчёт об изменениях)
$ git tag -a 1.2
```

### Release branch: возврат изменений в develop

Перенос релизных правок обратно в `develop`.

```shell
$ git checkout develop
Switched to branch 'develop'
$ git merge --no-ff release-1.2
Merge made by recursive.
(Отчёт об изменениях)
```

### Release branch: удаление ветки

Очистка завершённой ветки релиза.

```shell
$ git branch -d release-1.2
Deleted branch release-1.2 (was ff452fe).
```

### Hotfix branch: создание ветки

Ответвление срочного исправления от `master`.

![Ветви исправлений](/images/git/hotfix_branches.png)

```shell
$ git checkout -b hotfix-1.2.1 master
Switched to a new branch "hotfix-1.2.1"
$ ./bump-version.sh 1.2.1
Files modified successfully, version bumped to 1.2.1.
$ git commit -a -m "Bumped version number to 1.2.1"
[hotfix-1.2.1 41e61bb] Bumped version number to 1.2.1
1 files changed, 1 insertions(+), 1 deletions(-)
```

### Hotfix branch: фиксация исправления

Коммит правки в ветке исправления.

```shell
$ git commit -m "Fixed severe production problem"
[hotfix-1.2.1 abbe5d6] Fixed severe production problem
5 files changed, 32 insertions(+), 17 deletions(-)
```

### Hotfix branch: выпуск исправления

Слияние в `master` и тегирование патча.

```shell
$ git checkout master
Switched to branch 'master'
$ git merge --no-ff hotfix-1.2.1
Merge made by recursive.
(Отчёт об изменениях)
$ git tag -a 1.2.1
```

### Hotfix branch: возврат изменений в develop

Перенос исправлений в ветку разработки.

```shell
$ git checkout develop
Switched to branch 'develop'
$ git merge --no-ff hotfix-1.2.1
Merge made by recursive.
(Отчёт об изменениях)
```

### Hotfix branch: удаление ветки

Очистка завершённой ветки исправления.

```shell
$ git branch -d hotfix-1.2.1
Deleted branch hotfix-1.2.1 (was abbe5d6).
```
