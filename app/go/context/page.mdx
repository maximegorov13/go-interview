# Контекст

Контекст в Go — это интерфейс из стандартной библиотеки (`context`), который используется для управления процессами, передачи данных и уведомления горутин о завершении их работы. Контекст обеспечивает синхронизацию между различными частями программы и помогает избегать утечек горутин.

## Что такое контекст?

Контекст создан для:

1. **Хранения значений:** используется для передачи данных между функциями, которые могут быть связаны друг с другом.
2. **Управления временем выполнения:** позволяет установить таймауты и дедлайны для операций.
3. **Отмены задач:** уведомляет связанные горутины об отмене их работы.

Контекст всегда передаётся **первым параметром** в функции. Это считается **хорошей практикой**, так как:

- Упрощает управление временем выполнения.
- Предоставляет гибкие возможности для взаимодействия с горутинами.

## Виды контекстов

**`context.Background()`**

- Базовый или стартовый контекст.
- Используется для создания других контекстов.
- Обычно применяется в главных функциях (`main`, `init`) или тестах.

**`context.WithCancel()`**

- Создаёт новый контекст на основе родительского и возвращает:
  1. Новый контекст.
  2. Функцию `Cancel`, которую можно вызывать для отмены всех связанных с этим контекстом задач.
- Применяется, когда требуется вручную остановить выполнение горутин.

**`context.WithTimeout()`**

- Создаёт контекст с ограниченным временем выполнения (`time.Duration`).
- Когда таймаут истекает, контекст автоматически отменяет выполнение.
- Обычно используется с `defer` для вызова `Cancel`

**`context.WithDeadline()`**

- Позволяет задать конкретный момент времени (`time.Time`), когда контекст будет отменён.
- Возвращает:
  1. Новый контекст.
  2. Функцию `Cancel`.
- Применяется, если время завершения задачи уже известно заранее.

**`context.WithValue()`**

- Создаёт контекст с дополнительным значением, привязанным к ключу.
- Используется для передачи данных между функциями, связанных одним контекстом.

## Особенности контекста

1. **Иерархия и каскадность (дочерние контексты):**
   - Контексты образуют каскадную структуру. Если родительский контекст отменён, все дочерние также завершаются.
   - Это полезно для управления несколькими горутинами, выполняющими задачи в одном жизненном цикле.

2. **Иммутабельность:**
   - Контексты не изменяются после создания. Если требуется добавить данные или ограничения, создаётся новый контекст.

3. **Не рекомендуется хранить большие данные:**
   - Контекст предназначен для управления состоянием выполнения, а не для хранения больших структур данных.

## Основные методы интерфейса `Context`

1. `Done() <-chan struct{}`
   - Возвращает канал, который закрывается при отмене контекста.
   - Используется для обнаружения завершения.

2. `Err() error`
   - Возвращает причину завершения (`nil`, если контекст не завершён).
   - Возможные значения:
   - `context.Canceled` — вызван `Cancel`.
   - `context.DeadlineExceeded` — истёк таймаут или дедлайн.

3. `Deadline() (deadline time.Time, ok bool)`
   - Возвращает дедлайн выполнения (если установлен).

4. `Value(key interface{}) interface{}`
   - Извлекает значение, связанное с ключом.

## Ключевые вопросы

### 1. Что такое `context.Background()`?

Это базовый, пустой контекст, с которого начинаются все другие контексты.

### 2. Чем отличается `WithTimeout` от `WithDeadline`?

- **`WithTimeout`:** использует `time.Duration` для ограничения времени выполнения.
- **`WithDeadline`:** задаёт конкретный момент времени (`time.Time`), когда контекст должен завершиться.

### 3. Как отменить контекст?

Для отмены используется функция `Cancel`, возвращаемая методами `WithCancel`, `WithTimeout`, `WithDeadline`.

### 4. Какие методы у интерфейса `Context`?

1. `Done()` — канал завершения.
2. `Err()` — причина завершения.
3. `Deadline()` — дедлайн выполнения.
4. `Value()` — получение значения по ключу.

### 5. Что произойдёт, если отменить родительский контекст?

Все дочерние контексты автоматически завершаются.

### 6. Можно ли хранить большие структуры данных в контексте?

Нет, контекст предназначен для передачи состояния выполнения, а не для хранения данных.

### 7. Как избежать утечек горутин при использовании контекста?

Убедитесь, что контекст завершается корректно (например, вызов `defer cancel()` при использовании `WithCancel` или `WithTimeout`).
