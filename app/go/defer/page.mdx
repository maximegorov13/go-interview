# Defer

## Зачем нужна конструкция `defer`?

`defer` используется для упрощения управления ресурсами и логики, требующей выполнения определённых действий перед завершением функции.

Основные случаи применения:

- Гарантированное освобождение ресурсов (например, закрытие файлов, соединений).
- Упрощение сложной логики управления в функциях с множественными точками выхода.
- Реализация паттерна "открой-закрой" для ресурсов.
- Управление логгированием или очисткой временных данных.
- Обработка ошибок с сохранением читаемости кода.

## Какой концепт конструкция `defer` помогает реализовывать?

`defer` помогает реализовать концепцию **гарантированного выполнения завершающих действий** или **финализации**.

Ключевые принципы:

- Управление ресурсами: освобождение памяти, закрытие соединений, завершение работы объектов.
- Контроль логики выхода из функции: позволяет гарантировать, что завершающий код выполнится независимо от успешного или аварийного завершения функции.
- Работа с порядком выполнения: использование стека для последовательности вызовов.

## В какой момент инициализированное значение переменной передаётся в `defer`? Как это связано с именованием функции?

Значение переменной передаётся в `defer` в момент его **объявления**. Это означает, что все аргументы, переданные в функцию через `defer`, вычисляются и фиксируются в том виде, в котором они были на момент вызова `defer`.

Связь с именованием функции:

- Если `defer` использует именованные возвращаемые значения функции, то отложенные операции могут изменять эти значения, так как они уже вычислены к моменту выполнения `defer`.
- Если переменная изменяется после вызова `defer`, но до завершения функции, `defer` использует старое значение переменной, зафиксированное при объявлении.

## Как можно обработать панику с помощью `defer` и `recover`?

`defer` в сочетании с `recover` используется для обработки паник (`panic`) и предотвращения краха программы.

Принцип работы:

- Если в функции возникает паника, выполнение переходит к ближайшему `defer`.
- Внутри отложенной функции вызывается `recover`, чтобы "поймать" панику и получить к ней доступ.
- После этого можно обработать ошибку (например, записать в лог или корректно завершить программу).

Это позволяет завершить выполнение программы безопасным способом, даже если в процессе работы возникла ошибка.
